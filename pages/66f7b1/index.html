<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java IO模型 | Kangec blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="浅墨漫芳华 热爱生活，分享技术">
    <meta name="keywords" content="个人技术博客,后端,后端开发,后端框架,Spring,Spring面试题,技术文档,学习,面试,Java,js,ES6,vue,,Node,git,github,markdown">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.a53acfa3.css" as="style"><link rel="preload" href="/assets/js/app.4663b0ee.js" as="script"><link rel="preload" href="/assets/js/3.f705ad0c.js" as="script"><link rel="preload" href="/assets/js/10.c8cdf6e4.js" as="script"><link rel="prefetch" href="/assets/js/11.9afcabb3.js"><link rel="prefetch" href="/assets/js/12.df69db59.js"><link rel="prefetch" href="/assets/js/13.61fcc519.js"><link rel="prefetch" href="/assets/js/14.423ce86d.js"><link rel="prefetch" href="/assets/js/15.bff6355a.js"><link rel="prefetch" href="/assets/js/16.6a96c620.js"><link rel="prefetch" href="/assets/js/17.b65bf8f4.js"><link rel="prefetch" href="/assets/js/18.dbee088c.js"><link rel="prefetch" href="/assets/js/19.2303b154.js"><link rel="prefetch" href="/assets/js/20.7fc05395.js"><link rel="prefetch" href="/assets/js/21.e4d3520c.js"><link rel="prefetch" href="/assets/js/22.c21c798d.js"><link rel="prefetch" href="/assets/js/23.c89bbfaa.js"><link rel="prefetch" href="/assets/js/24.d6cda47c.js"><link rel="prefetch" href="/assets/js/25.f21c82b9.js"><link rel="prefetch" href="/assets/js/26.9b0f7646.js"><link rel="prefetch" href="/assets/js/27.65effe37.js"><link rel="prefetch" href="/assets/js/28.cf5448bf.js"><link rel="prefetch" href="/assets/js/29.467ce371.js"><link rel="prefetch" href="/assets/js/30.cc5dbcf2.js"><link rel="prefetch" href="/assets/js/31.25b02f2d.js"><link rel="prefetch" href="/assets/js/32.ef073d43.js"><link rel="prefetch" href="/assets/js/33.ccf3c739.js"><link rel="prefetch" href="/assets/js/34.3fc7e29f.js"><link rel="prefetch" href="/assets/js/35.c7405dfc.js"><link rel="prefetch" href="/assets/js/36.e1cb57e9.js"><link rel="prefetch" href="/assets/js/37.dcce3120.js"><link rel="prefetch" href="/assets/js/38.d9cabf67.js"><link rel="prefetch" href="/assets/js/39.988c6fd0.js"><link rel="prefetch" href="/assets/js/4.ef95372c.js"><link rel="prefetch" href="/assets/js/40.fac4c283.js"><link rel="prefetch" href="/assets/js/41.829c6f85.js"><link rel="prefetch" href="/assets/js/42.ed6ae218.js"><link rel="prefetch" href="/assets/js/43.095ca095.js"><link rel="prefetch" href="/assets/js/44.208d6532.js"><link rel="prefetch" href="/assets/js/45.8641b616.js"><link rel="prefetch" href="/assets/js/46.e5ce1e5b.js"><link rel="prefetch" href="/assets/js/47.82daa627.js"><link rel="prefetch" href="/assets/js/48.d7df86eb.js"><link rel="prefetch" href="/assets/js/49.0134ee8c.js"><link rel="prefetch" href="/assets/js/5.8a3e764f.js"><link rel="prefetch" href="/assets/js/50.170c88f1.js"><link rel="prefetch" href="/assets/js/51.8036121d.js"><link rel="prefetch" href="/assets/js/52.db0a1ff5.js"><link rel="prefetch" href="/assets/js/53.10788f6e.js"><link rel="prefetch" href="/assets/js/54.df822abe.js"><link rel="prefetch" href="/assets/js/55.c4176f99.js"><link rel="prefetch" href="/assets/js/56.6dc73046.js"><link rel="prefetch" href="/assets/js/57.64267579.js"><link rel="prefetch" href="/assets/js/58.c01e643e.js"><link rel="prefetch" href="/assets/js/59.f0d0e97e.js"><link rel="prefetch" href="/assets/js/6.2f4edb3e.js"><link rel="prefetch" href="/assets/js/60.54455006.js"><link rel="prefetch" href="/assets/js/61.772dbde2.js"><link rel="prefetch" href="/assets/js/62.c51804d9.js"><link rel="prefetch" href="/assets/js/63.90af9dbb.js"><link rel="prefetch" href="/assets/js/64.0e9d102e.js"><link rel="prefetch" href="/assets/js/65.39cf6c69.js"><link rel="prefetch" href="/assets/js/66.6bd2c9d5.js"><link rel="prefetch" href="/assets/js/67.a80b5ee6.js"><link rel="prefetch" href="/assets/js/68.e598f520.js"><link rel="prefetch" href="/assets/js/7.5a39d8a3.js"><link rel="prefetch" href="/assets/js/8.764e8ee7.js"><link rel="prefetch" href="/assets/js/9.c0d73f82.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.04b62663.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a53acfa3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Kangec blog" class="logo"> <span class="site-name can-hide">Kangec blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/food/" class="nav-link">美食</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专栏" class="dropdown-title"><a href="/column/" class="link-title">专栏</a> <span class="title" style="display:none;">专栏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/66f7b1/" aria-current="page" class="nav-link router-link-exact-active router-link-active"> Java基础</a></li><li class="dropdown-item"><!----> <a href="/pages/943ab2/" class="nav-link"> Netty</a></li><li class="dropdown-item"><!----> <a href="/pages/958a5b/" class="nav-link"> Spring</a></li><li class="dropdown-item"><!----> <a href="/pages/a7e17e/" class="nav-link"> Mybatis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/kangec/kangec.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/logo.png"> <div class="blogger-info"><h3>Kangec liu</h3> <span>
        浅墨漫芳华
      </span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/food/" class="nav-link">美食</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专栏" class="dropdown-title"><a href="/column/" class="link-title">专栏</a> <span class="title" style="display:none;">专栏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/66f7b1/" aria-current="page" class="nav-link router-link-exact-active router-link-active"> Java基础</a></li><li class="dropdown-item"><!----> <a href="/pages/943ab2/" class="nav-link"> Netty</a></li><li class="dropdown-item"><!----> <a href="/pages/958a5b/" class="nav-link"> Spring</a></li><li class="dropdown-item"><!----> <a href="/pages/a7e17e/" class="nav-link"> Mybatis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/kangec/kangec.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/66f7b1/" aria-current="page" class="active sidebar-link">Java IO模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/66f7b1/#io模型理解" class="sidebar-link">IO模型理解</a></li><li class="sidebar-sub-header"><a href="/pages/66f7b1/#文件描述符" class="sidebar-link">文件描述符</a></li><li class="sidebar-sub-header"><a href="/pages/66f7b1/#用户空间和内核空间" class="sidebar-link">用户空间和内核空间</a></li><li class="sidebar-sub-header"><a href="/pages/66f7b1/#i-o运行过程" class="sidebar-link">I/O运行过程</a></li><li class="sidebar-sub-header"><a href="/pages/66f7b1/#阻塞i-o模型" class="sidebar-link">阻塞I/O模型</a></li><li class="sidebar-sub-header"><a href="/pages/66f7b1/#非阻塞i-o模型" class="sidebar-link">非阻塞I/O模型</a></li><li class="sidebar-sub-header"><a href="/pages/66f7b1/#i-o复用模型" class="sidebar-link">I/O复用模型</a></li><li class="sidebar-sub-header"><a href="/pages/66f7b1/#i-o模型总结" class="sidebar-link">I/O模型总结</a></li></ul></li><li><a href="/pages/e17e9a/" class="sidebar-link">从ReentrantLock的实现看AQS的原理及应用</a></li><li><a href="/pages/5cc189/" class="sidebar-link">Java Steam API</a></li><li><a href="/pages/2d5efe/" class="sidebar-link">JAVA8函数式编程</a></li><li><a href="/pages/be6c9d/" class="sidebar-link">使用Reactor进行反应式编程</a></li><li><a href="/pages/790ca3/" class="sidebar-link">Java线程池原理(转美团技术团队)</a></li><li><a href="/pages/69cc3e/" class="sidebar-link">Java高并发编程之Synchronizer</a></li><li><a href="/pages/75dd83/" class="sidebar-link">Java高并发编程之ThreadLocal</a></li><li><a href="/pages/7b4b65/" class="sidebar-link">Java高并发编程之ReenTrantLock</a></li><li><a href="/pages/41c7d0/" class="sidebar-link">Java高并发编程之同步容器</a></li><li><a href="/pages/de3ddc/" class="sidebar-link">Java高并发编程之并发容器ConcurrentHashMap</a></li><li><a href="/pages/5f129f/" class="sidebar-link">Java高并发编程之并发容器 CopyOnWrite</a></li><li><a href="/pages/88fe8d/" class="sidebar-link">Java高并发编程之并发容器 BlockingQueue</a></li><li><a href="/pages/5b2999/" class="sidebar-link">Java高并发编程之其他常见并发容器</a></li><li><a href="/pages/d9ee4e/" class="sidebar-link">Java高并发编程之 Executor</a></li><li><a href="/pages/78a24d/" class="sidebar-link">Java高并发编程之线程池原理</a></li><li><a href="/pages/f4fb97/" class="sidebar-link">Java线程的六种状态</a></li><li><a href="/pages/0bf940/" class="sidebar-link">指令重排序</a></li><li><a href="/pages/8992be/" class="sidebar-link">volatile关键字详解</a></li><li><a href="/pages/fceb06/" class="sidebar-link">Java锁升级详解</a></li><li><a href="/pages/fdc52a/" class="sidebar-link">Java static关键字详解</a></li><li><a href="/pages/8a7c0e/" class="sidebar-link">聊聊Java的引用</a></li><li><a href="/pages/645a2b/" class="sidebar-link">HashMap详解</a></li><li><a href="/pages/2f6f30/" class="sidebar-link">深入了解Java 类加载器</a></li><li><a href="/pages/d1b4c7/" class="sidebar-link">JVM垃圾回收算法</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Netty专栏</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring专栏</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MyBatis专栏</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Reactor</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"> <div class="theme-vdoing-wrapper"><div class="articleInfo-wrap" data-v-14888ed5><div class="articleInfo" data-v-14888ed5><ul class="breadcrumbs" data-v-14888ed5><li data-v-14888ed5><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-14888ed5></a></li> <li data-v-14888ed5><a href="/column" title="专栏-目录页" data-v-14888ed5>专栏</a></li> <li data-v-14888ed5><a href="/column/#Java基础" title="专栏#Java基础" data-v-14888ed5>Java基础</a></li></ul> <div class="info" data-v-14888ed5><div title="作者" class="author iconfont icon-touxiang" data-v-14888ed5><a href="https://github.com/kangec" target="_blank" title="作者" class="beLink" data-v-14888ed5>Kangec liu</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-14888ed5><a href="javascript:;" data-v-14888ed5>2020-07-23</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          Java IO模型
        </h1> <div class="theme-vdoing-content content__default"><h1 id="java-io模型"><a href="#java-io模型" class="header-anchor">#</a> Java IO模型</h1> <p align="center"><img src="https://cdn.jsdelivr.net/gh/kangec/image_store/image323.png"></p> <p>在讲 BIO,NIO,AIO 之前先来回顾一下这样几个概念：同步与异步，阻塞与非阻塞。关于同步和异步的概念解读困扰着很多程序员，大部分的解读都会带有自己的一点偏见。参考了 Stackoverflow相关问题后对原有答案进行了进一步完善：</p> <blockquote><p>When you execute something synchronously, you wait for it to finish before moving on to another task. When you execute something asynchronously, you can move on to another task before it finishes.</p></blockquote> <blockquote><p>当你同步执行某项任务时，你需要等待其完成才能继续执行其他任务。当你异步执行某些操作时，你可以在完成另一个任务之前继续进行。</p></blockquote> <p><strong>Java 中的 BIO、NIO和 AIO 理解为是 Java 语言对操作系统的各种 IO 模型的封装。程序员在使用这些 API 的时候，不需要关心操作系统层面的知识，也不需要根据不同操作系统编写不同的代码。只需要使用Java的API就可以了。</strong></p> <p><strong>同步异步</strong></p> <ul><li>同步 ：两个同步任务相互依赖，并且一个任务必须以依赖于另一任务的某种方式执行。 比如在A-&gt;B事件模型中，你需要先完成 A 才能执行B。 再换句话说，同步调用种被调用者未处理完请求之前，调用不返回，调用者会一直等待结果的返回。</li> <li>异步： 两个异步的任务完全独立的，一方的执行不需要等待另外一方的执行。再换句话说，异步调用种一调用就返回结果不需要等待结果返回，当结果返回的时候通过回调函数或者其他方式拿着结果再做相关事情</li></ul> <p><strong>阻塞和非阻塞</strong></p> <ul><li>阻塞： 阻塞就是发起一个请求，调用者一直等待请求结果返回，也就是当前线程会被挂起，无法从事其他任务，只有当条件就绪才能继续。</li> <li>非阻塞： 非阻塞就是发起一个请求，调用者不用一直等着结果返回，可以先去干其他事情。</li></ul> <p><strong>如何区分 “同步/异步 ”和 “阻塞/非阻塞”</strong></p> <ul><li>同步/异步是从行为角度描述事物的，而阻塞和非阻塞描述的当前事物的状态（等待调用结果时的状态）。</li></ul> <h2 id="io模型理解"><a href="#io模型理解" class="header-anchor">#</a> IO模型理解</h2> <p>根据UNIX网络编程对I/O模型的分类，<strong>在UNIX可以归纳成5种I/O模型</strong>：</p> <ul><li><strong>阻塞I/O</strong></li> <li><strong>非阻塞I/O</strong></li> <li><strong>I/O多路复用</strong></li> <li>信号驱动I/O</li> <li>异步I/O</li></ul> <h2 id="文件描述符"><a href="#文件描述符" class="header-anchor">#</a> 文件描述符</h2> <p>Linux 的内核将所有外部设备<strong>都看做一个文件来操作</strong>，对一个文件的读写操作会<strong>调用内核提供的系统命令(api)</strong>，返回一个<code>file descriptor</code>（fd，文件描述符）。而对一个socket的读写也会有响应的描述符，称为<code>socket fd</code>（socket文件描述符），描述符就是一个数字，<strong>指向内核中的一个结构体</strong>（文件路径，数据区等一些属性）。</p> <ul><li>所以说：在Linux下对文件的操作是<strong>利用文件描述符(file descriptor)来实现的</strong>。</li></ul> <h2 id="用户空间和内核空间"><a href="#用户空间和内核空间" class="header-anchor">#</a> 用户空间和内核空间</h2> <p>为了保证用户进程不能直接操作内核（kernel），<strong>保证内核的安全</strong>，操心系统将虚拟空间划分为两部分</p> <ul><li><strong>一部分为内核空间</strong>。</li> <li><strong>一部分为用户空间</strong>。</li></ul> <h2 id="i-o运行过程"><a href="#i-o运行过程" class="header-anchor">#</a> I/O运行过程</h2> <p>我们来看看IO在系统中的运行是怎么样的(我们<strong>以read为例</strong>)</p> <p><img alt="" data-src="/img/3/3-1.jpg" loading="lazy" class="lazy"></p> <p>可以发现的是：当应用程序调用read方法时，是需要<strong>等待</strong>的---&gt;从内核空间中找数据，再将内核空间的数据拷贝到用户空间的。</p> <ul><li><strong>这个等待是必要的过程</strong>！</li></ul> <p>下面只讲解用得最多的3个I/0模型：</p> <ul><li><strong>阻塞I/O</strong></li> <li><strong>非阻塞I/O</strong></li> <li><strong>I/O多路复用</strong></li></ul> <h2 id="阻塞i-o模型"><a href="#阻塞i-o模型" class="header-anchor">#</a> 阻塞I/O模型</h2> <p>在进程(用户)空间中调用<code>recvfrom</code>，其系统调用直到数据包到达且<strong>被复制到应用进程的缓冲区中或者发生错误时才返回</strong>，在此期间<strong>一直等待</strong>。</p> <p><img alt="" data-src="/img/3/3-2.jpg" loading="lazy" class="lazy"></p> <h2 id="非阻塞i-o模型"><a href="#非阻塞i-o模型" class="header-anchor">#</a> 非阻塞I/O模型</h2> <p><code>recvfrom</code>从应用层到内核的时候，如果没有数据就<strong>直接返回</strong>一个EWOULDBLOCK错误，一般都对非阻塞I/O模型<strong>进行轮询检查这个状态</strong>，看内核是不是有数据到来。</p> <p><img alt="" data-src="/img/3/3-3.jpg" loading="lazy" class="lazy"></p> <h2 id="i-o复用模型"><a href="#i-o复用模型" class="header-anchor">#</a> I/O复用模型</h2> <p>前面也已经说了：在Linux下对文件的操作是<strong>利用文件描述符(file descriptor)来实现的</strong>。</p> <p>在Linux下它是这样子实现I/O复用模型的：</p> <ul><li>调用<code>select/poll/epoll/pselect</code>其中一个函数，<strong>传入多个文件描述符</strong>，如果有一个文件描述符<strong>就绪，则返回</strong>，否则阻塞直到超时。</li></ul> <p>比如<code>poll()</code>函数是这样子的：<code>int poll(struct pollfd *fds,nfds_t nfds, int timeout);</code></p> <p>其中 <code>pollfd</code> 结构定义如下：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">pollfd</span> <span class="token punctuation">{</span> 
	<span class="token keyword">int</span> fd<span class="token punctuation">;</span> <span class="token comment">/* 文件描述符 */</span> 
	<span class="token keyword">short</span> events<span class="token punctuation">;</span> <span class="token comment">/* 等待的事件 */</span> 
	<span class="token keyword">short</span> revents<span class="token punctuation">;</span> <span class="token comment">/* 实际发生了的事件 */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img alt="" data-src="/img/3/3-4.jpg" loading="lazy" class="lazy"></p> <p><img alt="" data-src="/img/3/3-5.jpg" loading="lazy" class="lazy"></p> <ul><li>（1）当用户进程调用了select，那么整个进程会被block；</li> <li>（2）而同时，kernel会“监视”所有select负责的socket；</li> <li>（3）当任何一个socket中的数据准备好了，select就会返回；</li> <li>（4）这个时候用户进程再调用read操作，将数据从kernel拷贝到用户进程(空间)。</li> <li>所以，I/O 多路复用的特点是<strong>通过一种机制一个进程能同时等待多个文件描述符</strong>，而这些文件描述符<strong>其中的任意一个进入读就绪状态</strong>，select()函数<strong>就可以返回</strong>。</li></ul> <p>select/epoll的优势并不是对于单个连接能处理得更快，而是<strong>在于能处理更多的连接</strong>。</p> <h2 id="i-o模型总结"><a href="#i-o模型总结" class="header-anchor">#</a> I/O模型总结</h2> <p>正经的描述都在上面给出了，不知道大家理解了没有。下面我举几个例子总结一下这三种模型：</p> <p><strong>阻塞I/O：</strong></p> <ul><li>Java3y跟女朋友去买喜茶，排了很久的队终于可以点饮料了。我要绿研，谢谢。可是喜茶不是点了单就能立即拿，于是我<strong>在喜茶门口等了一小时才拿到</strong>绿研。</li> <li>在门口干等一小时</li></ul> <p><strong>非阻塞I/O：</strong></p> <ul><li>Java3y跟女朋友去买一点点，排了很久的队终于可以点饮料了。我要波霸奶茶，谢谢。可是一点点不是点了单就能立即拿，<strong>同时</strong>服务员告诉我：你大概要等半小时哦。你们先去逛逛吧~于是Java3y跟女朋友去玩了几把斗地主，感觉时间差不多了。于是<strong>又去一点点问</strong>：请问到我了吗？我的单号是xxx。服务员告诉Java3y：还没到呢，现在的单号是XXX，你还要等一会，可以去附近耍耍。问了好几次后，终于拿到我的波霸奶茶了。</li> <li>去逛了下街、斗了下地主，时不时问问到我了没有</li></ul> <p><strong>I/O复用模型：</strong></p> <ul><li>Java3y跟女朋友去麦当劳吃汉堡包，现在就厉害了可以使用微信小程序点餐了。于是跟女朋友找了个地方坐下就用小程序点餐了。点餐了之后玩玩斗地主、聊聊天什么的。<strong>时不时听到广播在复述XXX请取餐</strong>，反正我的单号还没到，就继续玩呗。~~<strong>等听到广播的时候再取餐就是了</strong>。时间过得挺快的，此时传来：Java3y请过来取餐。于是我就能拿到我的麦辣鸡翅汉堡了。</li> <li>听广播取餐，<strong>广播不是为我一个人服务</strong>。广播喊到我了，我过去取就Ok了。</li></ul></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/kangec/kangec.github.io/edit/master/docs/02.专栏/01.Java基础/01.Java IO模型.md" target="_blank" rel="noopener noreferrer">编辑</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="tags"><a href="/tags/?tag=%E5%9F%BA%E7%A1%80" title="标签">
      #基础
    </a><a href="/tags/?tag=IO%E6%A8%A1%E5%9E%8B" title="标签">
      #IO模型
    </a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020/07/25, 14:07:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><!----> <a href="/pages/e17e9a/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">
        从ReentrantLock的实现看AQS的原理及应用
      </div></a></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/pages/e17e9a/">从ReentrantLock的实现看AQS的原理及应用</a>
        →
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/b211b5/"><div>深入了解ByteBuf</div></a> <span>09-20</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/56970a/"><div>Spring常见面试题一</div></a> <span>09-17</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/f8c895/"><div>Mybatis常见面试题汇总</div></a> <span>09-16</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div> </main></div> <div class="footer"><div class="icons"><a href="mailto:ardien@126.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/kangec" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="http://music.163.com/playlist?id=630677470" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
     | Copyright © 2021-2020
    <span>Kangec | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url(https://i.loli.net/2020/09/02/H24vouiMnG81N9l.jpg) center center / cover no-repeat;"></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4663b0ee.js" defer></script><script src="/assets/js/3.f705ad0c.js" defer></script><script src="/assets/js/10.c8cdf6e4.js" defer></script>
  </body>
</html>